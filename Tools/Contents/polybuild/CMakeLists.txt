INCLUDE(PolycodeIncludes)

FIND_PACKAGE(LibArchive REQUIRED)
FIND_PACKAGE(ZLIB)

INCLUDE_DIRECTORIES(
    ${ZLIB_INCLUDE_DIR}    
    ${LIBARCHIVE_INCLUDE_DIR} 
    Include)

ADD_EXECUTABLE(polybuild Source/polybuild.cpp Include/polybuild.h)
IF(MSVC OR MINGW)
    TARGET_LINK_LIBRARIES(polybuild Polycore ${LUA_LIBRARIES} ${PHYSFS_LIBRARY} ${LIBARCHIVE_LIBRARY} ${ZLIB_LIBRARIES})
ELSEIF(APPLE)
    TARGET_LINK_LIBRARIES(polybuild Polycore ${LUA_LIBRARIES} ${PHYSFS_LIBRARY} ${LIBARCHIVE_LIBRARY} ${ZLIB_LIBRARIES} "-framework IOKit" "-framework Cocoa")
    SET( CMAKE_EXE_LINKER_FLAGS  "${CMAKE_EXE_LINKER_FLAGS} -pagezero_size 10000 -image_base 100000000" ) 
ELSE(MSVC OR MINGW)
    TARGET_LINK_LIBRARIES(polybuild Polycore ${LUA_LIBRARIES} ${PHYSFS_LIBRARY} ${LIBARCHIVE_LIBRARY} ${ZLIB_LIBRARIES} dl)
ENDIF(MSVC OR MINGW)

IF(POLYCODE_INSTALL_FRAMEWORK)
        INSTALL(TARGETS polybuild DESTINATION Tools)
ENDIF(POLYCODE_INSTALL_FRAMEWORK)
